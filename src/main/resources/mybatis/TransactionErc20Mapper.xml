<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ether.data.dao.TransactionErc20Mapper">
    <resultMap id="BaseResultMap" type="com.ether.data.entity.TransactionErc20">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        <id column="transactionHash" jdbcType="VARCHAR" property="transactionhash"/>
        <id column="blockHash" jdbcType="VARCHAR" property="blockhash"/>
        <id column="contractAddress" jdbcType="VARCHAR" property="contractaddress"/>
        <id column="index" jdbcType="INTEGER" property="index"/>
        <result column="methodHash" jdbcType="VARCHAR" property="methodhash"/>
        <result column="blockNumber" jdbcType="BIGINT" property="blocknumber"/>
        <result column="from" jdbcType="VARCHAR" property="from"/>
        <result column="to" jdbcType="VARCHAR" property="to"/>
        <result column="value" jdbcType="VARCHAR" property="value"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        transactionHash, blockHash, contractAddress, `index`, methodHash, blockNumber, `from`,
        `to`, `value`
    </sql>
    <select id="selectByPrimaryKey" parameterType="com.ether.data.entity.TransactionErc20Key" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        select
        <include refid="Base_Column_List"/>
        from transaction_erc20
        where transactionHash = #{transactionhash,jdbcType=VARCHAR}
        and blockHash = #{blockhash,jdbcType=VARCHAR}
        and contractAddress = #{contractaddress,jdbcType=VARCHAR}
        and index = #{index,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="com.ether.data.entity.TransactionErc20Key">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        delete from transaction_erc20
        where transactionHash = #{transactionhash,jdbcType=VARCHAR}
        and blockHash = #{blockhash,jdbcType=VARCHAR}
        and contractAddress = #{contractaddress,jdbcType=VARCHAR}
        and index = #{index,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.ether.data.entity.TransactionErc20">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        insert into transaction_erc20 (transactionHash, blockHash, contractAddress,
        index, methodHash, blockNumber,
        from, to, value)
        values (#{transactionhash,jdbcType=VARCHAR}, #{blockhash,jdbcType=VARCHAR}, #{contractaddress,jdbcType=VARCHAR},
        #{index,jdbcType=INTEGER}, #{methodhash,jdbcType=VARCHAR}, #{blocknumber,jdbcType=BIGINT},
        #{from,jdbcType=VARCHAR}, #{to,jdbcType=VARCHAR}, #{value,jdbcType=VARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="com.ether.data.entity.TransactionErc20">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        insert into transaction_erc20
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="transactionhash != null">
                transactionHash,
            </if>
            <if test="blockhash != null">
                blockHash,
            </if>
            <if test="contractaddress != null">
                contractAddress,
            </if>
            <if test="index != null">
                index,
            </if>
            <if test="methodhash != null">
                methodHash,
            </if>
            <if test="blocknumber != null">
                blockNumber,
            </if>
            <if test="from != null">
                from,
            </if>
            <if test="to != null">
                to,
            </if>
            <if test="value != null">
                value,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="transactionhash != null">
                #{transactionhash,jdbcType=VARCHAR},
            </if>
            <if test="blockhash != null">
                #{blockhash,jdbcType=VARCHAR},
            </if>
            <if test="contractaddress != null">
                #{contractaddress,jdbcType=VARCHAR},
            </if>
            <if test="index != null">
                #{index,jdbcType=INTEGER},
            </if>
            <if test="methodhash != null">
                #{methodhash,jdbcType=VARCHAR},
            </if>
            <if test="blocknumber != null">
                #{blocknumber,jdbcType=BIGINT},
            </if>
            <if test="from != null">
                #{from,jdbcType=VARCHAR},
            </if>
            <if test="to != null">
                #{to,jdbcType=VARCHAR},
            </if>
            <if test="value != null">
                #{value,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.ether.data.entity.TransactionErc20">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        update transaction_erc20
        <set>
            <if test="methodhash != null">
                methodHash = #{methodhash,jdbcType=VARCHAR},
            </if>
            <if test="blocknumber != null">
                blockNumber = #{blocknumber,jdbcType=BIGINT},
            </if>
            <if test="from != null">
                from = #{from,jdbcType=VARCHAR},
            </if>
            <if test="to != null">
                to = #{to,jdbcType=VARCHAR},
            </if>
            <if test="value != null">
                value = #{value,jdbcType=VARCHAR},
            </if>
        </set>
        where transactionHash = #{transactionhash,jdbcType=VARCHAR}
        and blockHash = #{blockhash,jdbcType=VARCHAR}
        and contractAddress = #{contractaddress,jdbcType=VARCHAR}
        and index = #{index,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.ether.data.entity.TransactionErc20">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 24 10:45:12 CST 2024.
        -->
        update transaction_erc20
        set methodHash = #{methodhash,jdbcType=VARCHAR},
        blockNumber = #{blocknumber,jdbcType=BIGINT},
        from = #{from,jdbcType=VARCHAR},
        to = #{to,jdbcType=VARCHAR},
        value = #{value,jdbcType=VARCHAR}
        where transactionHash = #{transactionhash,jdbcType=VARCHAR}
        and blockHash = #{blockhash,jdbcType=VARCHAR}
        and contractAddress = #{contractaddress,jdbcType=VARCHAR}
        and index = #{index,jdbcType=INTEGER}
    </update>


    <select id="getContractTransactionByContractAddress" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT A.transactionHash,
               A.blockHash,
               A.contractAddress,
               A.`index`,
               SUBSTRING(A.methodHash, 1, 10) as methodHash,
               A.blockNumber,
               A.`from`,
               A.`to`,
               A.`value`,
               B.`timestamp`,
               C.cumulativeGasUsed,
               C.effectiveGasPrice,
               SUBSTRING_INDEX(D.method, '(', 1) as method
        FROM transaction_erc20 A
                 LEFT JOIN block B ON A.blockHash = B.`hash`
                 LEFT JOIN transaction_receipt C ON A.transactionHash = C.transactionHash
                 LEFT JOIN method_hash D ON SUBSTRING(A.methodHash, 1, 10) = D.hash
        where A.contractAddress = #{contractaddress,jdbcType=VARCHAR}
          and SUBSTRING(methodHash, 1, 10) in ('0xddf252ad', '0x8c5be1e5')
        order by A.blockNumber desc, A.transactionHash asc, A.index asc
    </select>

    <select id="getContractTransactionByAddress" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT A.transactionHash,
               A.blockHash,
               A.contractAddress,
               A.`index`,
               SUBSTRING(A.methodHash, 1, 10) as methodHash,
               A.blockNumber,
               A.`from`,
               A.`to`,
               A.`value`,
               B.`timestamp`,
               C.ercName,
               C.ercSymbol,
               C.decimals,
               SUBSTRING_INDEX(D.method, '(', 1) as method
        FROM (SELECT * FROM transaction_erc20 WHERE SUBSTRING(methodHash, 1, 10) in ('0xddf252ad', '0x8c5be1e5')) A
                 LEFT JOIN block B ON A.blockHash = B.`hash`
                 LEFT JOIN contract C ON A.contractAddress = C.contractAddress
                 LEFT JOIN method_hash D ON SUBSTRING(A.methodHash, 1, 10) = D.hash
        where A.from = #{address,jdbcType=VARCHAR}
           or A.to = #{address,jdbcType=VARCHAR}
        order by A.blockNumber desc, A.transactionHash asc, A.index asc
    </select>

    <select id="selectAllContractTransation" resultType="java.util.Map">
        SELECT A.transactionHash,
               A.blockHash,
               A.contractAddress,
               A.`index`,
               SUBSTRING(A.methodHash, 1, 10) as methodHash,
               A.blockNumber,
               A.`from`,
               A.`to`,
               A.`value`,
               B.`timestamp`,
               C.ercName,
               C.ercSymbol,
               C.decimals,
               SUBSTRING_INDEX(D.method, '(', 1) as method
        FROM (SELECT * FROM transaction_erc20 WHERE SUBSTRING(methodHash, 1, 10) in ('0xddf252ad', '0x8c5be1e5')) A
                 LEFT JOIN block B ON A.blockHash = B.`hash`
                 LEFT JOIN contract C ON A.contractAddress = C.contractAddress
                 LEFT JOIN method_hash D ON SUBSTRING(A.methodHash, 1, 10) = D.`hash`
        ORDER BY A.blockNumber DESC,
                 A.transactionHash ASC,
                 A.index ASC
    </select>

    <select id="selectByTransactionHash" parameterType="java.lang.String" resultType="java.util.Map">
        select A.transactionHash,
               A.blockHash,
               A.contractAddress,
               A.`index`,
               A.methodHash,
               A.blockNumber,
               A.`from`,
               A.`to`,
               A.`value`,
               D.method
        from transaction_erc20 A
                 LEFT JOIN method_hash D ON SUBSTRING(A.methodHash, 1, 10) = D.`hash`
        where transactionHash = #{transactionhash,jdbcType=VARCHAR}
        ORDER BY `index`
    </select>

    <select id="getContractTransactionCountByAddress" parameterType="java.lang.String" resultType="java.lang.Long">
        select count(1)
        from transaction_erc20
        where contractAddress = #{contractaddress,jdbcType=VARCHAR}
          and SUBSTRING(methodHash, 1, 10) in ('0xddf252ad', '0x8c5be1e5')
    </select>


    <select id="selectInternalTransactionByHash" parameterType="java.lang.String" resultType="java.util.Map">
        select A.transactionHash as 'transactionhash', A.blockHash,
               A.contractAddress,
               A.`index`,
               A.methodHash,
               A.blockNumber,
               A.`from`,
               A.`to`,
               A.`value`,
               B.`timestamp` as  'utc'
        from platform_internal_transaction A
                 left join block B on A.blockHash = B.`hash`
        where A.transactionHash = #{transactionHash,jdbcType=VARCHAR}
        order by A.`index`
    </select>


    <select id="selectInternalTransactionByAddress" parameterType="java.lang.String" resultType="java.util.Map">
        select A.transactionHash as 'transactionhash', A.blockHash,
               A.contractAddress,
               A.`index`,
               A.methodHash,
               A.blockNumber,
               A.`from`,
               A.`to`,
               A.`value`,
               B.`timestamp` as  'utc'
        from platform_internal_transaction A
                 left join block B on A.blockHash = B.`hash`
        where A.`from` = #{address,jdbcType=VARCHAR}
           or A.`to` = #{address,jdbcType=VARCHAR}
        order by B.`timestamp` desc
    </select>

    <select id="getContractTransaction" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT A.transactionHash as 'hash', A.`from`,
               A.`to`,
               A.`value`,
               B.`timestamp`
        FROM (SELECT * FROM transaction_erc20 WHERE SUBSTRING(methodHash, 1, 10) = '0xddf252ad') A
                 LEFT JOIN block B ON A.blockHash = B.`hash`
        where (A.from = #{address,jdbcType=VARCHAR} or A.to = #{address,jdbcType=VARCHAR})
          and A.contractAddress = #{contractaddress,jdbcType=VARCHAR}
        order by A.blockNumber desc, A.transactionHash asc, A.index asc limit 40
    </select>
</mapper>